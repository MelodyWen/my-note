# node 管理
> 参考文章：
> 1. https://k8smeetup.github.io/docs/concepts/configuration/assign-pod-node/
> 2. https://kuboard.cn/learning/k8s-bg/architecture/nodes-mgmt.html#%E8%8A%82%E7%82%B9%E6%8E%A7%E5%88%B6%E5%99%A8%EF%BC%88node-controller%EF%BC%89
> 3. https://k8smeetup.github.io/docs/user-guide/kubectl-conventions/

## 第一部分 分配 Pod 到 Node 上

### 1.1 nodeSelector
**nodeSelector 是最简单的控制方式。** nodeSelector 是 PodSpec 中的一个字段，它指定了键-值对的映射。如果想要 pod 能够运行在某个 node 上，那么这个 node 必须具有所有指定的键-值对的标签（node 也能拥有其它标签）。最常用的方式是单键-值对。

我们来看一个如何使用 nodeSelector 的例子。
```
apiVersion: v1
kind: Pod
metadata:
  name: nginx
  labels:
    env: test
spec:
  containers:
  - name: nginx
    image: nginx
    imagePullPolicy: IfNotPresent
  nodeSelector:
    disktype: ssd
```
> 此 pod 将被分配到拥有 `disktype: ssd` label 的 node上

### 1.2 插曲：内置的 node 标签
除了 自己打标签，node 已经预先附加了一个标准标签集。在 Kubernetes 1.4 版本中，这些标签有

- kubernetes.io/hostname
- failure-domain.beta.kubernetes.io/zone
- failure-domain.beta.kubernetes.io/region
- beta.kubernetes.io/instance-type
- beta.kubernetes.io/os
- beta.kubernetes.io/arch

### 1.3 亲和性（Affinity）和反亲和性（Anti-affinity）
> 略

### 1.4 添加和移除标签
添加label语法
```sh
kubectl label nodes <node-name> <label-key>=<label-value>
```
删除label语法
```sh
kubectl label nodes <node-name> <label-key>-
```
修改Label的值
语法: 需要加上--overwrite参数
```sh
kubectl label nodes <node-name> <label-key>=<label-value> --overwrite
```
查询label 标签
```sh
[root@master ~]# kubectl get nodes --show-labels
NAME     STATUS   ROLES    AGE   VERSION   LABELS
master   Ready    master   96m   v1.16.3   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=master,kubernetes.io/os=linux,node-role.kubernetes.io/master=
node1    Ready    <none>   65m   v1.16.3   abc=aaa,beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node1,kubernetes.io/os=linux,sdf=dfsdf
node2    Ready    <none>   65m   v1.16.3   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node2,kubernetes.io/os=linux
```

























---
